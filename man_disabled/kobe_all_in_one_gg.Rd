% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/kobe_all_in_one_gg.R
\encoding{UTF-8}
\name{kobe_all_in_one_gg}
\alias{kobe_all_in_one_gg}
\title{All-in-one Kobe plot (ggplot2)}
\usage{
kobe_all_in_one_gg(
  rep,
  logax = FALSE,
  plot.legend = TRUE,
  man.legend = TRUE,
  ext = TRUE,
  rel.axes = FALSE,
  xlim = NULL,
  ylim = NULL,
  labpos = c(1, 1),
  xlabel = NULL,
  stamp = NULL,
  verbose = TRUE,
  CI = 0.95,
  scenario_colors = NULL,
  origin_offset_frac = 0.04
)
}
\arguments{
\item{rep}{A fitted SPiCT report object of class \code{spictcls}
(result of \code{elu2::fit.elu2()}). Must have \code{inp$reportmode == 0}.}

\item{logax}{Logical; if \code{TRUE}, both axes are log-scaled (log10). Default \code{FALSE}.}

\item{plot.legend}{Logical; show the small top-right legend for
\eqn{\mathrm{E}(B_{\infty})} (and “True” if present). Default \code{TRUE}.}

\item{man.legend}{Logical; when management scenarios exist in \code{rep$man}, show
their legend. Default \code{TRUE}.}

\item{ext}{Logical; add secondary axes with relative units on the top/right
when \code{rel.axes = FALSE}. Ignored when \code{rel.axes = TRUE}. Default \code{TRUE}.}

\item{rel.axes}{Logical; plot axes as relative units
\eqn{B_t/B_{\mathrm{MSY}}} vs. \eqn{F_t/F_{\mathrm{MSY}}}. Forces \code{ext = FALSE}.
Default \code{FALSE}.}

\item{xlim, ylim}{Numeric length-2 vectors giving x/y limits. If \code{NULL}
(default), limits are computed from the ellipse, time series, and reference
points with a small padding to avoid border overlap.}

\item{labpos}{Integer length-2; relative positions for the first/last-year
labels (used internally when computing offsets). Default \code{c(1, 1)}.}

\item{xlabel}{Optional x-axis label (overrides the default). Default \code{NULL}.}

\item{stamp}{Optional character string stamped at the lower-right margin
(e.g., a version tag). Default \code{NULL}.}

\item{verbose}{Logical; print notes/warnings (e.g., if a parameter cannot be
extracted). Default \code{TRUE}.}

\item{CI}{Numeric in \verb{(0,1)}; confidence level used when extracting
parameters and constructing intervals (e.g., \code{0.95}). Default \code{0.95}.}
}
\value{
(Invisibly) returns the \code{ggplot} object, and prints it as a side effect.
}
\description{
Produces a Kobe plot of fishing mortality vs. biomass using a fitted
\strong{SPiCT} result, rendered with \strong{ggplot2}. The plot includes colored
quadrants, an MSY reference-point “banana” (ellipse from
\eqn{\log B_{\mathrm{MSY}}}–\eqn{\log F_{\mathrm{MSY}}} covariance), the
biomass–F trajectory, optional management-scenario overlays, first/last-year
markers, and optional secondary axes in relative units.
}
\details{
The function expects a fitted object of class \code{spictcls} (from
\code{elu2::fit.elu2()}) with \code{inp$reportmode == 0} so that all states are
reported. When \code{rel.axes = TRUE}, the plot uses relative axes
\eqn{B_t/B_{\mathrm{MSY}}} vs. \eqn{F_t/F_{\mathrm{MSY}}} (and the extra
top/right secondary axes are suppressed). If either \code{inp$timevaryinggrowth}
or \code{inp$logmcovflag} is \code{TRUE}, relative axes are enforced.

For sub-annual time steps (\code{min(inp$dtc) < 1}), biomass and fishing
mortality series are aggregated to annual means for plotting. The MSY
“banana” is computed from the estimated covariance of
\eqn{\log B_{\mathrm{MSY}}} and \eqn{\log F_{\mathrm{MSY}}}. If the
\strong{ellipse} package is available, a proper ellipse is used; otherwise, a
fallback point at (\eqn{B_{\mathrm{MSY}}}, \eqn{F_{\mathrm{MSY}}}) is drawn.

If management scenarios are present in \code{rep$man}, their trajectories (and
the intermediate period up to the management start) are overlaid and can be
shown in a legend. Otherwise, a one-step prediction segment and the
\eqn{\mathrm{E}(B_{\infty})} marker are drawn.
}
\section{Secondary axes}{

When \code{rel.axes = FALSE} and \code{ext = TRUE}, duplicated axes are added on the
top and right that convert absolute units to relative units using the
estimated \eqn{B_{\mathrm{MSY}}} and \eqn{F_{\mathrm{MSY}}}. Labels format \code{1}
exactly as \code{"1"} for easy identification of the MSY thresholds.
}

\section{Dependencies}{

Requires \strong{ggplot2}. If available, \strong{ellipse} is used for the MSY
covariance ellipse. Uses \code{stats::qnorm} and \code{scales::pretty_breaks}
(referenced with explicit namespaces).
}

\examples{
\dontrun{
# (Pseudo-code) Fit a SPiCT model, then:
# rep <- elu2::fit.elu2(inp)

# Default: absolute axes
kobe_all_in_one_gg(rep)

# Relative axes (B/Bmsy vs F/Fmsy) with log scaling
kobe_all_in_one_gg(rep, rel.axes = TRUE, logax = TRUE)

# Show management overlays but hide their legend, add a stamp
kobe_all_in_one_gg(rep, man.legend = FALSE, stamp = "Analysis v1.0")
}

}
\seealso{
\code{elu2::fit.elu2()} for model fitting; \code{spict::plotspict()} for base plots.
}
\author{
Elhadji Ndiaye & Contributors
}
